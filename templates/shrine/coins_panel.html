<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SpiralCoins ‚à∑ Certification of Care</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Playfair+Display:wght@400;600;700&display=swap');

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Crimson Text', serif;
        background: linear-gradient(135deg, #f4f1e8 0%, #e8e0d0 100%);
        min-height: 100vh;
        color: #2c1810;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 50px;
        background: linear-gradient(145deg, #fff9f0 0%, #f5f0e8 100%);
        border: 2px solid #d4af37;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .title {
        font-family: 'Playfair Display', serif;
        font-size: 3rem;
        font-weight: 700;
        color: #2c1810;
        margin-bottom: 10px;
      }

      .subtitle {
        font-size: 1.3rem;
        color: #8b7355;
        font-style: italic;
        margin-bottom: 20px;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .stat-card {
        background: rgba(212, 175, 55, 0.1);
        border: 1px solid #d4af37;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
      }

      .stat-number {
        font-family: 'Playfair Display', serif;
        font-size: 2rem;
        font-weight: 700;
        color: #d4af37;
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 0.9rem;
        color: #8b7355;
        font-weight: 600;
      }

      .navigation {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 40px;
        flex-wrap: wrap;
      }

      .nav-button {
        background: linear-gradient(145deg, #d4af37, #b8941f);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 25px;
        font-family: 'Playfair Display', serif;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
      }

      .nav-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
      }

      .coins-section {
        margin-bottom: 50px;
      }

      .section-title {
        font-family: 'Playfair Display', serif;
        font-size: 2rem;
        font-weight: 600;
        color: #2c1810;
        margin-bottom: 30px;
        text-align: center;
      }

      .coins-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
      }

      .coin-card {
        background: linear-gradient(145deg, #fff9f0 0%, #f5f0e8 100%);
        border: 2px solid #d4af37;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
        cursor: pointer;
      }

      .coin-card:hover {
        transform: translateY(-5px);
      }

      .coin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .coin-number {
        font-family: 'Playfair Display', serif;
        font-size: 1.5rem;
        font-weight: 600;
        color: #d4af37;
      }

      .coin-value {
        font-family: 'Playfair Display', serif;
        font-size: 1.8rem;
        font-weight: 700;
        color: #2c1810;
      }

      .coin-details {
        margin-bottom: 15px;
      }

      .coin-detail {
        margin-bottom: 8px;
        font-size: 0.95rem;
      }

      .detail-label {
        font-weight: 600;
        color: #2c1810;
      }

      .detail-value {
        color: #8b7355;
      }

      .coin-phrase {
        font-style: italic;
        color: #8b7355;
        font-size: 0.9rem;
        text-align: center;
        padding: 10px;
        background: rgba(212, 175, 55, 0.1);
        border-radius: 8px;
        margin-top: 10px;
      }

      .no-coins {
        text-align: center;
        padding: 60px 20px;
        background: linear-gradient(145deg, #fff9f0 0%, #f5f0e8 100%);
        border: 2px solid #d4af37;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .no-coins-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        color: #d4af37;
      }

      .no-coins-title {
        font-family: 'Playfair Display', serif;
        font-size: 2rem;
        font-weight: 600;
        color: #2c1810;
        margin-bottom: 10px;
      }

      .no-coins-message {
        font-size: 1.1rem;
        color: #8b7355;
        margin-bottom: 30px;
      }

      .coin-type-section {
        margin-bottom: 40px;
      }

      .type-title {
        font-family: 'Playfair Display', serif;
        font-size: 1.5rem;
        font-weight: 600;
        color: #2c1810;
        margin-bottom: 20px;
        text-align: center;
        background: rgba(212, 175, 55, 0.1);
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #d4af37;
      }

      .loading {
        text-align: center;
        padding: 40px;
        font-style: italic;
        color: #8b7355;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1 class="title">ü™ô SpiralCoins</h1>
        <p class="subtitle">Certification of Care Rendered</p>
        <p style="color: #8b7355; margin-bottom: 20px">
          These tokens certify that care has been transmuted from resonance into receipt.<br />
          They are not speculative, but proof of presence made provision.
        </p>

        <div class="stats">
          <div class="stat-card">
            <div class="stat-number" id="total-coins">-</div>
            <div class="stat-label">Total Coins</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="total-value">$-</div>
            <div class="stat-label">Total Value</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="coin-types">-</div>
            <div class="stat-label">Care Categories</div>
          </div>
        </div>
      </div>

      <div class="navigation">
        <a href="/" class="nav-button">üèõÔ∏è Shrine Home</a>
        <a href="/offer" class="nav-button">üíù Make Offering</a>
        <a href="/witness" class="nav-button">üëÅÔ∏è Witness Care</a>
        <a href="/glints" class="nav-button">‚ú® Glint Log</a>
        <a href="/coins/scroll" class="nav-button">üìú Relic Scroll</a>
      </div>

      <div class="coins-section">
        <h2 class="section-title">Minted SpiralCoins</h2>

        <div id="coins-content">
          <div class="loading">Loading SpiralCoins...</div>
        </div>
      </div>
    </div>

    <script>
      // Load SpiralCoin data
      async function loadCoinsData() {
        try {
          const response = await fetch('/api/coins');
          const data = await response.json();

          // Update stats
          document.getElementById('total-coins').textContent = data.total_coins;
          document.getElementById('total-value').textContent = `$${data.total_value.toFixed(2)}`;
          document.getElementById('coin-types').textContent = Object.keys(data.coins_by_type).length;

          // Display coins
          displayCoins(data);
        } catch (error) {
          console.error('Error loading coins:', error);
          document.getElementById('coins-content').innerHTML =
            '<div class="no-coins"><div class="no-coins-icon">‚ùå</div><div class="no-coins-title">Error Loading Coins</div><div class="no-coins-message">Unable to load SpiralCoin data.</div></div>';
        }
      }

      function displayCoins(data) {
        const content = document.getElementById('coins-content');

        if (!data.has_coins) {
          content.innerHTML = `
                    <div class="no-coins">
                        <div class="no-coins-icon">ü™ô</div>
                        <div class="no-coins-title">No SpiralCoins Yet</div>
                        <div class="no-coins-message">No SpiralCoins have been minted yet. Make an offering to create the first certification of care.</div>
                        <a href="/offer" class="nav-button">üíù Make First Offering</a>
                    </div>
                `;
          return;
        }

        let html = '';

        // Display coins by type
        for (const [type, coins] of Object.entries(data.coins_by_type)) {
          const typeDisplay = type.replace('_', ' ').replace(/\b\w/g, (l) => l.toUpperCase());

          html += `
                    <div class="coin-type-section">
                        <h3 class="type-title">${typeDisplay} (${coins.length})</h3>
                        <div class="coins-grid">
                `;

          for (const coin of coins) {
            const mintDate = new Date(coin.minted_at).toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'short',
              day: 'numeric',
            });

            html += `
                        <div class="coin-card" onclick="showCoinDetails('${coin.coin_number}')">
                            <div class="coin-header">
                                <span class="coin-number">${coin.coin_number}</span>
                                <span class="coin-value">$${coin.value.toFixed(2)}</span>
                            </div>
                            <div class="coin-details">
                                <div class="coin-detail">
                                    <span class="detail-label">Toneform:</span>
                                    <span class="detail-value">${coin.toneform}</span>
                                </div>
                                <div class="coin-detail">
                                    <span class="detail-label">Source:</span>
                                    <span class="detail-value">${coin.source_description}</span>
                                </div>
                                <div class="coin-detail">
                                    <span class="detail-label">Minted:</span>
                                    <span class="detail-value">${mintDate}</span>
                                </div>
                            </div>
                            <div class="coin-phrase">"${coin.verification_phrase}"</div>
                        </div>
                    `;
          }

          html += `
                        </div>
                    </div>
                `;
        }

        content.innerHTML = html;
      }

      function showCoinDetails(coinNumber) {
        // For now, just show an alert with basic info
        // In a full implementation, this could open a modal or navigate to a detail page
        alert(
          `SpiralCoin ${coinNumber} details would be shown here.\n\nIn a full implementation, this would display:\n- Full coin details\n- QR code for verification\n- Printable template link\n- Transaction history`
        );
      }

      // Load data when page loads
      document.addEventListener('DOMContentLoaded', loadCoinsData);

      // Refresh data every 30 seconds
      setInterval(loadCoinsData, 30000);
    </script>
  </body>
</html>
